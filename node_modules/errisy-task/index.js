'use strict';var Task=function(){function a(b){var c=this;this.cancel=function(){c._status='cancelled',c.children.forEach(function(d){return d.cancel()})},this.children=[],this.resolve=function(d){'cancelled'==c._status||(c.result=d,c.result instanceof Promise?(c._status='resolving',c.result.then(c.resolveEvaluated,c.rejectEvaluated)):c.result instanceof a?(c._status='resolving',c.append(c.result),c.result.then(c.resolveEvaluated,c.rejectEvaluated)):(c._status='resolved',c.next()))},this.reject=function(d){'cancelled'==c._status||(c.reason=d,c.result instanceof Promise?(c._status='rejecting',c.result.then(c.rejectEvaluated,c.rejectEvaluated)):c.result instanceof a?(c._status='rejecting',c.append(c.result),c.result.then(c.rejectEvaluated,c.rejectEvaluated)):(c._status='rejected',c.next()))},this.resolveEvaluated=function(d){'cancelled'==c._status||(c.result=d,c._status='resolved',c.next())},this.rejectEvaluated=function(d){'cancelled'==c._status||(c.reason=d,c._status='rejected',c.next())},this.next=function(){switch(c._status){case'resolved':if(c.onfulfilled)try{var d=c.onfulfilled(c.result);c.nextTask.resolve(d)}catch(f){c.nextTask.reject(f)}break;case'rejected':if(c.onrejected)try{var d=c.onrejected(c.reason);c.nextTask.resolve(d)}catch(f){c.nextTask.reject(f)}break;default:}},this._status='pending',b&&b(this.resolve,this.reject,this)}return a.prototype.append=function(b){return this.children.push(b),b.parent=this,b},a.prototype.clear=function(){this.children=[]},a.prototype.then=function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];return this.onfulfilled=b[0],this.onrejected=b[1],(this.onfulfilled||this.onrejected)&&(this.nextTask=new a(function(){}),this.append(this.nextTask)),this.next(),this.nextTask},a.prototype.catch=function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];return this.onrejected=b[0],this.onrejected&&(this.nextTask=new a(function(){}),this.append(this.nextTask)),this.next(),this.nextTask},Object.defineProperty(a.prototype,'status',{get:function(){return this._status},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,'cancelled',{get:function(){return'cancelled'==this._status},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,'[Symbol.toStringTag]',{get:function(){return'Task'},enumerable:!0,configurable:!0}),a.prototype.all=function(){for(var b=this,c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];return c.forEach(function(f){return b.append(f)}),Promise.all(c)},a}();module&&(module.exports=exports),module.exports=Task;